#   Refer for explanation to following link:
#   https://github.com/evilmartians/lefthook/blob/master/docs/configuration.md
#
#
pre-commit:
  parallel: true
  commands:
    biome-check: &biome
      run: npx @biomejs/biome check --no-errors-on-unmatched --files-ignore-unknown=true --write {staged_files}
    biome-format:
      run: npx @biomejs/biome format --no-errors-on-unmatched --files-ignore-unknown=true --write {staged_files}
      <<: *biome
    biome-lint:
      run: npx @biomejs/biome lint --no-errors-on-unmatched --files-ignore-unknown=true --write {staged_files}
      <<: *biome

    rustfmt:
      run: cargo fmt --all
    clippy:
      run: cargo clippy --fix --allow-dirty --allow-staged
      

    # nixpkgs-fmt:
    #   glob: "*.nix"
    #   run: nixpkgs-fmt

    links:
      glob: "*.md"
      exclude: CHANGELOG.md
      run: lychee --max-concurrency 3 {staged_files}

    fix-typos:
      exclude: '(^|/)((.*)\.pub|Cargo.lock|flake.lock|package-lock.json$'
      file_types:
        - text
        - not symlink
      run: typos --write-changes {staged_files}
